<!DOCTYPE html>
<html>
<head>
  <title>Aplicaciones Multimedia</title>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
  <meta name="author" content="Israel Gutiérrez Rojas, igrojas@it.uc3m.es" />
  <link REL="SHORTCUT ICON" HREF="http://www.uc3m.es/favicon.ico"> 
  <link href="http://www.it.uc3m.es/rcrespo/docencia/asignatura.css" rel="stylesheet" type="text/css" />
  <link href="http://www.it.uc3m.es/estilo.css" rel="stylesheet" type="text/css" />
<link href="http://www.it.uc3m.es/rcrespo/docencia/amm/1112/p3/css/amm.css" rel="stylesheet" type="text/css" />
<link href="../css/classon.css" rel="stylesheet" type="text/css" />
		<link href="../css/jquery-ui.css" rel="stylesheet" type="text/css" />
		
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
		<script type="text/javascript" src="../js/jquery.blockUI.js"></script>


</head>

<body>

<!-- BEGIN ADD, 21/05/09; to comply with UC3M corporate image requirements -->
<div class="headerBorderUc3mblue">&nbsp;</div>
<div class="header white">
  <table class="header white">
  <tr>
  <td width="25%"><a href="http://www.uc3m.es/"><img class="logos logoleft" src="http://www.it.uc3m.es/imag/EscudoLogoCorporativo.png" alt="Universidad Carlos III de Madrid"></a></td>
  <td class="header txtcntr" align="center">
  <span class="minititulo">Aplicaciones Multimedia - Curso 2012-13</a>
  <!-- <a href="/rcrespo/docencia/amm/1112/" class="minititulo">Aplicaciones Multimedia - Curso 2011-12</a> -->
  </td>
  <td width="25%"><a href="http://www.it.uc3m.es"><img class="logos logoright" src="http://www.it.uc3m.es/imag/SpanishLogoIT.png" alt="Departamento de Ingeniería Telemática"></td>
</div>
<div class="headerBorderUc3mblue"></div>
<!-- END ADD 21/05/09 -->


<!-- Tabla encabezado departamento -->
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#000000">
  <tr>
    <td>

<!-- BEGIN SUBSTITUTE, 21/05/09 -->
<!--
      <table width="100%" border="0" cellspacing="1" cellpadding="0" height="50">
-->
      <table width="100%" border="0" cellspacing="1" cellpadding="0">  
<!-- END SUBSTITUTE, 21/05/09 -->


        <tr>
          <td bgcolor="#CCD0D6" width="2000" height="22">
            <div align="right"><a href="http://www.it.uc3m.es/localizacion/localizacion.htm" class="azul">Localizaci&oacute;n</a>
              | <a href="#"></a><a href="http://www.it.uc3m.es/personal/directorio.htm"><span class="rojo">Personal</span></a>
              | <a href="http://www.it.uc3m.es/docencia/docencia.htm" class="azul">Docencia</a>

              | <a href="http://www.it.uc3m.es/investigacion/investigacion.htm" class="azul">Investigaci&oacute;n</a>
              | <a href="http://www.it.uc3m.es/novedades/novedades.htm" class="azul">Novedades</a>
              | <a href="http://www.it.uc3m.es/intranet/intranet.htm" class="azul">Intranet</a>
              &nbsp;&nbsp;</div>
          </td>

        </tr>
      </table>
    </td>
  </tr>
</table>

<!-- Tabla encabezado departamento (fin) -->


<!-- Navegación -->
<p class="nav"><a class="azul"
href="http://www.it.uc3m.es/index.html">Home</a> / <a class="azul"
href="http://www.it.uc3m.es/docencia/docencia.htm">Docencia</a> / <a
class="azul" href="http://www.it.uc3m.es/docencia/grado-audiovisuales.html">Grado en Ingeniería de Sistemas Audiovisuales</a> / <a class="azul" href="/rcrespo/docencia/amm/1112/">Aplicaciones Multimedia</a> <!-- <span class="peq">Aplicaciones Multimedia</span> -->
</p>
<!-- Navegación (fin) -->

<header>
<h1>HTML5: Aspectos avanzados</h1>
</header>

<!-- Demos -->
<section id="intro">
<h2 class="minititulo">Objetivo: realizar un programa de captura y procesaro de imagen de video, estilo instagram</h2>

<p>
 HTML5 introduce varios aspectos avanzados, desde almacenamiento offline y comunicación en tiempo real, hasta acceso al hardware y selección de elementos en JavaScript.
</p>

<p>
 En esta práctica vamos a hacer uso de la API de acceso a medios locales (MediaStream) para acceder a una webcam conectada al equipo desde nuestro navegador. El objetivo será desarrollar un aplicación similar a Instagram, que permita al usuario probar distintos efectos en el video capturado con una webcam y hacer una captura de la imagen de la cámara con un efecto aplicado. 
</p>

<p>El correcto funcionamiento de las webcam en la sala de ordenadores ha sido probado en la instalación de Windows 7 de los equipos administrados por el departamento de informática. Podéis realizar la práctica en el entorno que queráis, pero quizá tengáis que instalar los drivers de las webcam para que funcione.</p>

</section>

<section id="step1">
<h2 class="minititulo">Paso 1: acceso a medios locales</h2>

<p>
  Como primer paso para la creación de nuestra aplicación, tendremos que acceder a los medios locales mediante el API MediaStream. Para ello, usaremos la función <em>navigator.webkitUserMedia</em> como se vio en <a href="http://www.it.uc3m.es/igrojas/amm/html5-avanzado/template/#35">clase de teoría</a>. Cuando el acceso al medio sea exitoso, habrá que vincular el stream creado con un elemento video que hayamos creado en el HTML de la página mediante la función <em>webkitURL.createObject</em>, que crea una fuente de datos a partir del stream que podemos asignar como fuente(<em>src</em>) del elemento video.
</p>

<p>
  Además crearemos dos botones en la página, uno para iniciar el acceso a medios (como se ha descrito en el párrafo anterior). Y otro apra detener el acceso, para lo cual borraremos la fuente del stream del elemento de video.
</p>

<p>
  Para que el acceso a medios funcione correctamente debe accederse a la página desarrollada desde un servidor web. Para ello tenéis varias alternativas:
  <ul>
    <li>Poner las páginas las páginas en el servidor web de vuestra cuenta de Telemática, en la carpeta ~/lib/www/ como explican en la <a href="http://www.etl.it.uc3m.es/Web_alumnos">wiki del equipo técnico de laboratorio</a></li>
    <li>Descargar un servidor web simple. Por ejemplo, podéis descargar <a href="https://code.google.com/p/mongoose/">mongoose</a> y ponerlo en la carpeta donde esté vuestro código HTML. Por defecto usa el puerto 8080 de la máquina local que está cerrado en vuestras máquinas, usad <a href="mongoose.conf">este fichero de configuración</a> para poder acceder al servidor en <a href="http://localhost:5800/">http://localhost:5800/</a>.</li>
  </ul>
</p>
</section>

<section id="step2">
<h2 class="minititulo">Paso 2: uso del canvas para el procesado de la señal de video</h2>

<p>
  En este apartado haremos uso del elemento <em>canvas</em> para procesar la señal de video que viene de la webcam. Para ello se crearán dos elementos canvas: uno secundario para hacer el procesamiento de los datos, que no crearemos en el HTML sino en JavaScript porque no nos interesa mostrarlo en la página. Y otro primario en la página web donde mostraremos los resultados del procesamiento. Al crear los elementos canvas usaremos el mismo tamaño que para el elemento video, de forma que se haga un procesado para todos los píxeles del video.
</p>

<p>
  El procesamiento de la señal de video consta de los siguientes pasos:
  <ul>
    <li>En primer lugar, capturaremos el frame actual del elemento video y lo pintaremos en el canvas secundario. Para ello usaremos la función <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#drawing-images">drawImage</a> cuyo primer parámetro puede ser un elemento de video en cuyo caso captura el frame actual del video.</li>
    <li>A continuación accederemos a la información de los píxeles pintados en el canvas secundario. Para ello usaremos la función <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#pixel-manipulation">getImageData</a>, que nos devuelve un objeto cuyo atributo <em>data</em> es un array uni-dimensional con información RGB de cada píxel de la imagen del canvas.</li>
    <li>En tercer lugar haremos el procesado de píxeles sobre el array RGB para aplicar el efecto deseado: blanco y negro, negativo, sepia, etc. Para ello se proporciona una librería JS (<a href="effects.js">effects.js</a>) con funciones que aplican varios efectos.</li>
    <li>Finalmente, se pintará el array RGB obtenido tras el procesamiento mediante la función <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#pixel-manipulation">putImageData</a> en el canvas primario, visible por el usuario.</li>
  </ul>
</p>

<p>
  Para que en el canvas aparezca el video con el procesado requerido, tendremos que repetir el proceso anterior continuamente mientras el video se esté reproduciendo. Para ello usaremos alguna función que nos permita hacerlo cada cierto tiempo, como <em>setTimeout</em> o <em>setInterval</em>.
</p>
</section>

<section id="step3">
<h2 class="minititulo">Paso 3: Adecuación de la interfaz</h2>

<p>
  En este paso simplemente debéis adecuar la interfaz al de una aplicación para realizar fotografías con efectos. Se sugieren realizar una serie de mejoras visuales con el objetivo de mejorar la experiencia del usuario:
  <ul>
    <li>Que el elemento video aparezca oculto para que el usuario sólo vea el video procesado.</li>
    <li>Botones para la interacción del usuario: inicio del video, para pararlo, para aplicar cada uno de los efectos, etc.</li>
    <li>Un botón para tomar una instantánea, que haremos funcionar en el paso siguiente.</li>
  </ul>
</p>

</section>

<section id="step4">
<h2 class="minititulo">Paso 4: Captura de la foto</h2>

<p>
  Finalmente desarrollaremos una función asociada al botón de tomar una fotografía. Para ello accederemos a los datos de la imagen del canvas primario cuando se pulse el botón mediante la función <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dom-canvas-todataurl">toDataURL</a>. Con la URL obtenida, mostraremos la foto en un elemento imagen de la página.
</p>
</section>

<section id="refs">

<h2 class="minititulo">Referencias</h2>

<ul>
  <li><a href="http://www.it.uc3m.es/igrojas/amm/html5-avanzado/template/">Apuntes de clase sobre aspectos avanzados de HTML5</a></li>
  <li><a href="http://html5doctor.com/video-canvas-magic/">video + canvas = magic</a></li>
  <li><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#pixel-manipulation">The canvas element: pixel manipulation</a></li>
  <li><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#drawing-images">The canvas element: drawing images</a></li>
  <li><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dom-canvas-todataurl">The canvas element: toDataURL</a></li>
</ul>
</section>

<footer>
      <figure>
        <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/es/">
        <img alt="Licencia Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/es/88x31.png" /></a>
        <figcaption>Este <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" rel="dct:type">obra</span> 
        está bajo una <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/es/">licencia Creative Commons 
        Reconocimiento-CompartirIgual 3.0 España</a>.</figcaption>
      </figure>
      <details>
        <summary>Recurso desarollado por Israel Gutiérrez (<a href="mailto:igrojas@it.uc3m.es">igrojas@it.uc3m.es</a>), data de <time datetime="2013-02-25">2013-02-25</time>.</summary>
      </details>
      <br /><br /><br />
    </footer>
<script type="text/javascript" src="../js/socket.io.min.js"></script>
<script type="text/javascript" src="../js/classon.js?session=p5"></script>
</body>
</html>
